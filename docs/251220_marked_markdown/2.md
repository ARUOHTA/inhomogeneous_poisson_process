## 2 モデルの定式化

本節では，黒曜石出土データに対するマーク付き点過程モデルを定式化する．本研究の特徴は，遺跡の存在位置を表す点過程部分と，産地構成比を表すマーク部分を分離し，異なる構造を与える点にある．具体的には：

- **点過程部分**：全時期のデータを統合した空間的な非斉次ポアソン過程としてモデル化する．これは，遺跡の立地選好（標高，傾斜，河川との距離など）が縄文時代を通じて大きく変わらないという考古学的仮定に基づく．
- **マーク部分**：各時期について独立な多項ロジットモデルを適用する．産地構成比は交易ネットワークや人口分布の変動により時期ごとに異なるパターンを示すと考えられるためである．

最終的には，点過程とマークが因子分解可能な一つの階層ベイズモデルとして記述される．

### 2.1 データ構造と記法

考察対象とする空間領域を，ユークリッド空間の有界領域
$$
\mathcal{S} \subset \mathbb{R}^2
$$
とする．時間軸については，縄文時代の離散的な時期区分（早期，前期，中期，後期，晩期など）を用い，
$$
\mathcal{T} = \{1, 2, \dots, T\}
$$
のように有限個の時点（期間を代表するインデックス）として扱う．

#### 遺跡位置データ

時期 $t$ に属する遺跡の集合を
$$
X_t = \{s_i : i \in I_t\} \subset \mathcal{S}
$$
と表す．ここで $I_t$ は時期 $t$ に属する遺跡のインデックス集合である．全時期の遺跡を統合した集合を
$$
X_{\mathrm{all}} = \bigcup_{t=1}^T X_t
$$
と定義し，その要素数を $n_X = |X_{\mathrm{all}}|$ とする．

**注意**：同一の遺跡が複数の時期にわたって存続する場合，その空間位置は $X_{\mathrm{all}}$ において重複してカウントしない．すなわち，$X_{\mathrm{all}}$ は空間位置の集合としてユニークな点のみを含む．

#### マークデータ

各遺跡 $s_i \in X_t$（時期 $t$ に属する遺跡 $i$）からは，$K$ 種類の産地に分類された黒曜石が出土する．遺跡 $i$，時期 $t$ における産地 $k$ の出土個数を $y_{itk}$ と書き，ベクトル
$$
\boldsymbol{y}_{it} = (y_{it1}, \dots, y_{itK})^\top
$$
でまとめて表す．総出土数を
$$
N_{it} = \sum_{k=1}^K y_{itk}
$$
と定める．時期 $t$ における全マークデータの集合を
$$
\mathcal{Y}_t = \{\boldsymbol{y}_{it} : i \in I_t\}
$$
と書く．

#### 共変量と設計行列

空間位置に依存する共変量ベクトルを
$$
\boldsymbol{w}_{\mathrm{int}}(s), \quad \boldsymbol{w}_z(s)
$$
などと書く．点過程部分の共変量には標高，傾斜角，河川からの距離などを想定し，マーク部分には各産地までの距離などを含めることができる．これらを行ごとに並べた設計行列を $W_{\mathrm{int}}, W_z$ で表す．

### 2.2 遺跡位置に対する空間ポアソン点過程

遺跡位置の統合集合 $X_{\mathrm{all}}$ は，空間領域 $\mathcal{S}$ 上の非斉次ポアソン点過程としてモデル化する：
$$
X_{\mathrm{all}} \sim \mathrm{IPP}(\lambda),
$$
すなわち任意の可測集合 $A \subset \mathcal{S}$ に対して
$$
X_{\mathrm{all}}(A) \sim \mathrm{Poisson}\left(\Lambda(A)\right), \quad \Lambda(A) = \int_A \lambda(s) \, ds,
$$
さらに互いに素な集合 $A_1, \dots, A_m$ について $X_{\mathrm{all}}(A_1), \dots, X_{\mathrm{all}}(A_m)$ は互いに独立であると仮定する．

**重要**：本モデルでは点過程部分に時間依存性を持たせない．これは以下の考古学的仮定に基づく：

> **仮定 2.1**（立地選好の時間的安定性）：縄文時代を通じて，遺跡の立地を規定する要因（標高，傾斜，水源へのアクセス等）は大きく変化しなかった．

この仮定のもと，全時期のデータを統合することで，点過程パラメータの推定精度を高めることができる．

#### 強度関数の分解

Moreira and Gamerman (2022) に従い，強度関数を
$$
\lambda(s) = \lambda^* \cdot q(s), \quad 0 < q(s) < 1,
$$
と分解する．ここで，$\lambda^* > 0$ は空間全体にわたる上限強度であり，$q(s)$ は「その地点に遺跡が存在する相対的な確率」を表す無次元の場として解釈される．$q(s)$ はロジスティック回帰型のリンク関数を用いて
$$
q(s) = \frac{\exp\{\eta_{\mathrm{int}}(s)\}}{1 + \exp\{\eta_{\mathrm{int}}(s)\}},
$$
$$
\eta_{\mathrm{int}}(s) = \boldsymbol{w}_{\mathrm{int}}(s)^\top \boldsymbol{\beta}_{\mathrm{int}} + u_{\mathrm{int}}(s),
$$
と定める．ここで $\boldsymbol{\beta}_{\mathrm{int}}$ は遺跡存在に影響する共変量の係数ベクトルであり，$u_{\mathrm{int}}(s)$ は遺跡の空間的なクラスタリングを表現するゼロ平均の潜在ガウス場である．$u_{\mathrm{int}}(s)$ には計算効率の観点から NNGP を事前分布として課す．

#### 点過程の尤度

観測された点パターン $X_{\mathrm{all}}$ の尤度は，標準的な非斉次ポアソン過程の理論から
$$
p(X_{\mathrm{all}} \mid \lambda^*, q) = \exp\left\{-\int_{\mathcal{S}} \lambda(s) \, ds\right\} \prod_{i=1}^{n_X} \lambda(s_i),
$$
すなわち
$$
p(X_{\mathrm{all}} \mid \lambda^*, q) = \exp\left\{-\lambda^* \int_{\mathcal{S}} q(s) \, ds\right\} (\lambda^*)^{n_X} \prod_{i=1}^{n_X} q(s_i),
$$
と書ける．積分項 $\int_{\mathcal{S}} q(s) \, ds$ は一般には解析的に計算できないため，後の節で偽不在点過程を導入することによりこの積分項を含まない擬似尤度を構成する．

### 2.3 マーク（産地構成比）に対する NNGP 多項ロジットモデル

次に，各時期 $t$ における遺跡 $s_i \in X_t$ に付随するマーク $\boldsymbol{y}_{it}$ の分布を定式化する．

#### 時期別独立モデル

本モデルの重要な特徴は，**マーク部分を時期ごとに独立にモデル化する**点にある：

> **仮定 2.2**（マークの時期別独立性）：各時期 $t$ における産地構成比パターンは，他の時期のパターンとは独立にモデル化される．

この仮定は，以下の考古学的観察に基づく：
- 交易ネットワークや移動パターンは時期によって大きく異なる
- 各時期のデータのみから当該時期の空間パターンを推定することで，時期固有の特徴を捉えやすくなる

#### 多項分布モデル

各時期 $t = 1, \dots, T$ について独立に，以下のモデルを仮定する．黒曜石の総出土数 $N_{it}$ は与えられた値として扱い，産地構成比
$$
\boldsymbol{\pi}_t(s) = \bigl(\pi_{t1}(s), \dots, \pi_{tK}(s)\bigr)^\top
$$
に従う多項分布
$$
\boldsymbol{y}_{it} \mid N_{it}, \boldsymbol{\pi}_t(s_i) \sim \mathrm{Multinomial}\bigl(N_{it}, \boldsymbol{\pi}_t(s_i)\bigr), \quad i \in I_t,
$$
を仮定する．

#### 多項ロジットリンク

産地構成比 $\boldsymbol{\pi}_t(s)$ は，多項ロジットリンクを用いて表現する．基準となる産地を $K$（例：「その他」カテゴリ）とし，$k = 1, \dots, K-1$ について
$$
\eta_{tk}(s) = \boldsymbol{w}_z(s)^\top \boldsymbol{\beta}_{tk} + u_{tk}(s),
$$
と定める．ここで $\boldsymbol{\beta}_{tk}$ は時期 $t$，産地 $k$ に固有の回帰係数ベクトルであり，$u_{tk}(s)$ は時期 $t$，産地 $k$ に対応する潜在ガウス場である．このとき
$$
\pi_{tk}(s) = \frac{\exp\{\eta_{tk}(s)\}}{1 + \sum_{k'=1}^{K-1} \exp\{\eta_{tk'}(s)\}}, \quad k = 1, \dots, K-1,
$$
および
$$
\pi_{tK}(s) = \frac{1}{1 + \sum_{k'=1}^{K-1} \exp\{\eta_{tk'}(s)\}}
$$
と定める．

#### 潜在ガウス場の事前分布

潜在場 $u_{tk}(s)$ には，NNGP による事前分布を課す．有限個の観測点集合 $\{s_i : i \in I_t\}$ における $u_{tk}$ のベクトル
$$
\boldsymbol{u}_{tk} = \bigl(u_{tk}(s_i)\bigr)_{i \in I_t}
$$
は，NNGP によって近似された多変量正規分布に従うものとする．

**重要**：異なる時期の潜在場 $u_{tk}(s)$ と $u_{t'k}(s)$（$t \neq t'$）は独立とする．これは仮定 2.2 の直接的な帰結である．

#### 距離依存事前分布

マーク部分の切片（$\boldsymbol{w}_z$ の定数項に対応する係数）には，各産地までの距離に基づく事前平均を設定することができる：
$$
\mu_{tk}(s) = \lambda_k \cdot g_k(s),
$$
ここで $g_k(s)$ は産地 $k$ への距離に基づいて計算される特徴量であり，$\lambda_k$ はその重みパラメータである．この距離依存事前分布により，「近い産地からより多くの黒曜石が得られやすい」という考古学的知識をモデルに組み込むことができる．
