## Appendix A：時間依存ガウス過程（DGP）による拡張

> **注意**：本Appendixで述べる拡張は，本研究の主モデルでは採用していない．ここでは，将来の拡張可能性として，時間方向の相関を持つガウス過程の導入方法を記録する．

---

### A.1 動機と基本的な考え方

本論の主モデルでは：

- **点過程**：全時期で共有（時間依存なし）
- **マーク**：各時期独立（時間相関なし）

という構造を採用した（§2 参照）．この構造は計算効率が高く，縄文時代の長期にわたって立地選好が大きく変わらないという考古学的仮定とも整合的である．

しかし，より精緻なモデルとして，「時間が近いほど類似した空間パターンをとる」という仮定を導入することも考えられる．本Appendixでは，このような時間依存構造を持つ動的ガウス過程（Dynamic Gaussian Process, DGP）の定式化を示す．

---

### A.2 時空間ガウス過程の定式化

#### 定義

空間領域 $\mathcal{S} \subset \mathbb{R}^2$ と離散時点 $t \in \{1, \dots, T\}$ の積空間上で定義されるガウス過程：
$$
u(s, t) \sim \mathrm{GP}\bigl(0, C((s,t), (s',t'))\bigr)
$$

#### セパラブル共分散

最も扱いやすいのは，空間と時間の直積型（セパラブル）共分散である：
$$
C((s,t), (s',t')) = \sigma^2 \cdot C_{\mathrm{space}}(s, s'; \phi) \cdot C_{\mathrm{time}}(t, t'; \rho)
$$

ここで：
- $C_{\mathrm{space}}(s, s'; \phi)$：空間共分散（例：指数型，Matérn 型）
- $C_{\mathrm{time}}(t, t'; \rho) = \rho^{|t - t'|}$：AR(1) 型の時間共分散
- $\sigma^2$：分散スケール
- $\phi, \rho$：ハイパーパラメータ（$0 < \rho < 1$）

---

### A.3 強度側への DGP 導入

点過程の強度に時間依存を導入する場合：
$$
\eta_{\mathrm{int}}(s, t) = \boldsymbol{w}_{\mathrm{int}}(s)^\top \boldsymbol{\beta}_{\mathrm{int}} + u_{\mathrm{int}}(s, t)
$$
$$
q(s, t) = \frac{\exp\{\eta_{\mathrm{int}}(s, t)\}}{1 + \exp\{\eta_{\mathrm{int}}(s, t)\}}
$$

ここで $u_{\mathrm{int}}(s, t)$ は時空間 GP であり：
$$
u_{\mathrm{int}}(\cdot, \cdot) \sim \mathrm{GP}\bigl(0, C_{\mathrm{int}}((s,t), (s',t'))\bigr)
$$

観測・偽不在点の時空間位置 $(s_1, t_1), \dots, (s_n, t_n)$ における評価ベクトル：
$$
\boldsymbol{u}_{\mathrm{int}} = \bigl(u_{\mathrm{int}}(s_1, t_1), \dots, u_{\mathrm{int}}(s_n, t_n)\bigr)^\top \sim \mathcal{N}(\boldsymbol{0}, \Sigma_{\mathrm{int}})
$$

#### Kronecker 積構造

セパラブル共分散を採用し，時点ごとの空間位置集合が共通の場合：
$$
\Sigma_{\mathrm{int}} = \Sigma_{\mathrm{time}}^{\mathrm{int}} \otimes \Sigma_{\mathrm{space}}^{\mathrm{int}}
$$

ここで：
- $\Sigma_{\mathrm{time}}^{\mathrm{int}}$：$T \times T$ の時間共分散行列
- $\Sigma_{\mathrm{space}}^{\mathrm{int}}$：空間位置についての共分散行列

NNGP を適用する場合は，空間側の精度行列 $Q_{\mathrm{space}}^{\mathrm{int}}$ を用いた近似を構成する．

---

### A.4 マーク側への DGP 導入

マーク部分に時間相関を導入する場合，各カテゴリ $k$ について：
$$
\eta_{tk}(s) = \boldsymbol{w}_z(s)^\top \boldsymbol{\beta}_{tk} + u_k(s, t)
$$

ここで $u_k(s, t)$ はカテゴリ $k$ 固有の時空間 GP：
$$
u_k(\cdot, \cdot) \sim \mathrm{GP}\bigl(0, C_k((s,t), (s',t'))\bigr)
$$

観測点におけるベクトル：
$$
\boldsymbol{u}_k = \bigl(u_k(s_1, t_1), \dots, u_k(s_{n_X}, t_{n_X})\bigr)^\top \sim \mathcal{N}(\boldsymbol{0}, Q_k^{-1})
$$

---

### A.5 DGP を導入した場合の完全条件付き分布

DGP を導入した場合でも，Polya-Gamma 拡張により，完全条件付き分布は以下の形を保つ：

#### 強度パラメータ

$$
\theta_{\mathrm{int}} = \begin{pmatrix} \boldsymbol{\beta}_{\mathrm{int}} \\ \boldsymbol{u}_{\mathrm{int}} \end{pmatrix} \mid \boldsymbol{\omega}, X, U \sim \mathcal{N}(\boldsymbol{m}_{\mathrm{int}}, V_{\mathrm{int}})
$$

ここで：
$$
V_{\mathrm{int}}^{-1} = H^\top \Omega H + R_0, \qquad R_0 = \begin{pmatrix} (B_0^{\mathrm{int}})^{-1} & 0 \\ 0 & Q_{\mathrm{int}} \end{pmatrix}
$$

$Q_{\mathrm{int}}$ は時空間精度行列．

#### マークパラメータ

$$
\theta_k = \begin{pmatrix} \boldsymbol{\beta}_k \\ \boldsymbol{u}_k \end{pmatrix} \mid \Xi, \mathcal{Y}, X \sim \mathcal{N}(\boldsymbol{m}_k, V_k)
$$

ここで $Q_k$ は時空間精度行列．

---

### A.6 計算上の課題

DGP 導入に伴う計算上の課題：

1. **次元の増大**：時空間結合により，精度行列のサイズが $nT \times nT$ に増大
2. **スパース性の喪失**：時間方向の相関により，精度行列の完全なスパース性が失われる
3. **推定の複雑化**：2段階推定が使えなくなり，全パラメータの同時推定が必要

これらの課題から，本研究では DGP を導入せず，点過程共有・マーク時期別独立モデルを採用した．

---

### A.7 将来の拡張として

DGP の導入が有効となる状況：

1. **時期間の連続性が強い場合**：隣接時期で類似した空間パターンが予想される場合
2. **データ量が十分な場合**：各時期に十分な遺跡数があり，時間相関の推定が安定する場合
3. **計算資源が豊富な場合**：大規模な時空間精度行列を扱える環境がある場合

本研究のデータ（時期あたり数十〜数百遺跡）では，時期別独立モデルで十分な推定精度が得られると判断した．
